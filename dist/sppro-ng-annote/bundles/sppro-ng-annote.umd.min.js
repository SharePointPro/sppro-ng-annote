!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("konva"),require("@fortawesome/free-solid-svg-icons"),require("@fortawesome/angular-fontawesome"),require("ngx-color/photoshop"),require("@angular/common")):"function"==typeof define&&define.amd?define("sppro-ng-annote",["exports","@angular/core","konva","@fortawesome/free-solid-svg-icons","@fortawesome/angular-fontawesome","ngx-color/photoshop","@angular/common"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self)["sppro-ng-annote"]={},t.ng.core,t.Konva,t.freeSolidSvgIcons,t.angularFontawesome,t.photoshop,t.ng.common)}(this,(function(t,e,o,a,n,r,i){"use strict";function l(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var s,c=l(o);!function(t){t[t.FreePathDrawable=0]="FreePathDrawable",t[t.SquareDrawable=1]="SquareDrawable",t[t.CircleDrawable=2]="CircleDrawable",t[t.ArrowDrawable=3]="ArrowDrawable",t[t.TextDrawable=4]="TextDrawable"}(s||(s={}));var h=function(t,e,o){return new c.default.Line({stroke:o,strokeWidth:2,points:[t,e],draggable:!0})},p=function(t,e,o){return new c.default.Rect({stroke:o,strokeWidth:2,x:t,y:e,width:0,height:0,draggable:!0})},u=function(t,e,o){return new c.default.Circle({stroke:o,strokeWidth:2,x:t,y:e,radius:0,draggable:!0})},d=function(t,e,o){return new c.default.Arrow({stroke:o,strokeWidth:2,points:[t,e],draggable:!0})},f=function(t,e,o,a,n){return new c.default.Text({stroke:o,strokeWidth:.1,x:t,y:e+1,text:n,draggable:!0,fontFamily:a,fontStyle:"normal"})},g="konva-text-editor",w=function(t,e,o,a,n){var r=b();y(r,t,e,o,a),m(r,n),setTimeout((function(){r.focus()}),100)},b=function(){var t=document.getElementById(g);t||(t=document.createElement("textarea"),document.getElementsByClassName("konvajs-content")[0].appendChild(t),t.style.position="absolute",t.id=g);return t},y=function(t,e,o,a,n){t.style.top=o+"px",t.style.left=e+"px",t.style.width="20px",t.style.height="20px",t.style.fontSize="12px",t.style.border="none",t.style.padding="0px",t.style.margin="0px",t.style.overflow="hidden",t.style.whiteSpace="nowrap",t.style.background="none",t.style.outline="none",t.style.resize="none",t.style.lineHeight="12px",t.style.transformOrigin="left top",t.style.color=a,t.style.fontFamily=n},m=function(t,e){t.addEventListener("input",(function(t){x(t.target)})),t.addEventListener("blur",(function(t){v(),e(t)}))},v=function(){var t=document.getElementById(g);null!=t&&t.parentNode.removeChild(t)},x=function(t){var e=t.scrollHeight,o=t.scrollWidth;t.style.width=o+"px",t.style.height=e+"px"},C=s.FreePathDrawable,S="Arial",D=function(){function t(){this.onSave=new e.EventEmitter,this._drawableType=C,this.isPaint=!1,this.mode="brush",this.color="#000000",this.textAreaVisible=!1}return Object.defineProperty(t.prototype,"drawableType",{get:function(){return this._drawableType},set:function(t){this._drawableType=t},enumerable:!1,configurable:!0}),t.prototype.ngOnInit=function(){var t=this;this.img=new Image,this.img.onload=function(){t.image=new c.default.Image({image:t.img}),t.initalizeStage(),t.layer=new c.default.Layer({}),t.layer.add(t.image),t.stage.add(t.layer)},this.img.src="https://sharepointpro.github.io/sppro-image-annote/static/media/room.fdc5a868.jpg"},t.prototype.initalizeStage=function(){var t=this;this.stage=new c.default.Stage({container:"stage",width:this.img.width,height:this.img.height}),this.stage.on("mousedown",(function(e){t.onMouseDown(e)})),this.stage.on("mouseup",(function(e){t.onMouseUp(e)})),this.stage.on("mousemove",(function(e){t.onMouseMove(e)}))},t.prototype.onMouseDown=function(t){var e=this;this.isPaint=!0;var o=this.stage.getPointerPosition();this.drawableType===s.FreePathDrawable&&(this.lastShape=h(o.x,o.y,this.color),this.layer.add(this.lastShape)),this.drawableType===s.SquareDrawable&&(this.lastShape=p(o.x,o.y,this.color),this.layer.add(this.lastShape)),this.drawableType===s.CircleDrawable&&(this.lastShape=u(o.x,o.y,this.color),this.layer.add(this.lastShape)),this.drawableType===s.ArrowDrawable&&(this.lastShape=d(o.x,o.y,this.color),this.layer.add(this.lastShape)),this.drawableType===s.TextDrawable&&(this.textAreaVisible||(this.textAreaVisible=!0,w(o.x,o.y,this.color,S,(function(t){""!==t.target.value&&(e.lastShape=f(o.x,o.y,e.color,S,t.target.value),e.layer.add(e.lastShape),e.layer.batchDraw(),e.textAreaVisible=!1)}))))},t.prototype.onSaveClick=function(){this.onSave.emit(this.stage.toDataURL())},t.prototype.onClear=function(){for(;this.layer.children.length>1;)this.onUndo();this.layer.batchDraw()},t.prototype.onMouseUp=function(t){this.isPaint=!1,this.lastShape=null},t.prototype.onUndo=function(){this.layer.children.length>1&&(this.layer.children.splice(-1,1),this.layer.batchDraw())},t.prototype.onMouseMove=function(t){if(this.isPaint&&this.lastShape&&this.lastShape!==s.TextDrawable){var e=this.stage.getPointerPosition();if(this.drawableType===s.FreePathDrawable){var o=this.lastShape.points().concat([e.x,e.y]);this.lastShape.points(o)}if(this.drawableType===s.SquareDrawable){var a=-(this.lastShape.attrs.x-e.x),n=-(this.lastShape.attrs.y-e.y);this.lastShape.attrs.width=a,this.lastShape.attrs.height=n}if(this.drawableType===s.CircleDrawable){a=this.lastShape.attrs.x-e.x,n=this.lastShape.attrs.y-e.y;var r=Math.sqrt(a*a+n*n);this.lastShape.attrs.radius=r}if(this.drawableType===s.ArrowDrawable)(o=[this.lastShape.attrs.points[0],this.lastShape.attrs.points[1]]).push(e.x),o.push(e.y),this.lastShape.points(o);this.layer.batchDraw()}},t}();D.decorators=[{type:e.Component,args:[{selector:"sppro-ng-annote",template:'<div class=\'overlay sppro-overlay\'>\r\n    <sppro-toolbar [(drawableType)]="drawableType" [(color)]="color" (onUndo)="onUndo()" (onClear)="onClear()" (onSave)="onSaveClick()"></sppro-toolbar>\r\n    <div class="centeredBox">\r\n        <div id="stage">\r\n            \r\n        </div>\r\n    </div>\r\n\r\n</div>',styles:[".centeredBox{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%)}.overlay{position:fixed;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,.6);z-index:1000}.closeButton{position:fixed;right:15px;top:15px;cursor:pointer}.crosshair{cursor:crosshair}.text{cursor:text}"]}]}],D.ctorParameters=function(){return[]},D.propDecorators={onSave:[{type:e.Output}]};var k=function(){function t(){this.drawableTypeChange=new e.EventEmitter,this.colorChange=new e.EventEmitter,this.onUndo=new e.EventEmitter,this.onClear=new e.EventEmitter,this.onSave=new e.EventEmitter,this.showColorPicker=!1,this.faPencilAlt=a.faPencilAlt,this.faSquare=a.faSquare,this.faCircle=a.faCircle,this.faLongArrowAltRight=a.faLongArrowAltRight,this.faFont=a.faFont,this.faSquareFull=a.faSquareFull,this.faUndo=a.faUndo,this.faBan=a.faBan,this.faSave=a.faSave,this.DrawableEnum=s}return t.prototype.ngOnInit=function(){},t.prototype.onDrawableChange=function(t){this.drawableTypeChange.emit(t)},t.prototype.getClass=function(t){var e="toolButton";return t===this.drawableType&&(e+=" active"),e},t.prototype.showColor=function(){this.showColorPicker=!0},t.prototype.onColorChange=function(t){this.colorChange.emit(t.color.hex)},t.prototype.onAccept=function(){var t=this;setTimeout((function(){t.showColorPicker=!1}))},t.prototype.onColorPicked=function(t){this.onColorChange(t)},t}();k.decorators=[{type:e.Component,args:[{selector:"sppro-toolbar",template:'<div class="toolbar sppro-toolbar">\n    <table class="toolbarTable">\n\n        <tbody>\n            <tr>\n                <td (click)="onDrawableChange(DrawableEnum.FreePathDrawable)"\n                    [ngClass]="getClass(DrawableEnum.FreePathDrawable)">\n                    <fa-icon [icon]="faPencilAlt"></fa-icon>\n                </td>\n            </tr>\n            <tr>\n                <td (click)="onDrawableChange(DrawableEnum.SquareDrawable)"\n                    [ngClass]="getClass(DrawableEnum.SquareDrawable)">\n                    <fa-icon [icon]="faSquare"></fa-icon>\n                </td>\n            </tr>\n            <tr>\n                <td (click)="onDrawableChange(DrawableEnum.CircleDrawable)"\n                    [ngClass]="getClass(DrawableEnum.CircleDrawable)">\n                    <fa-icon [icon]="faCircle"></fa-icon>\n                </td>\n            </tr>\n            <tr>\n                <td (click)="onDrawableChange(DrawableEnum.ArrowDrawable)"\n                    [ngClass]="getClass(DrawableEnum.ArrowDrawable)">\n                    <fa-icon [icon]="faLongArrowAltRight"></fa-icon>\n                </td>\n            </tr>\n            <tr>\n                <td (click)="onDrawableChange(DrawableEnum.TextDrawable)"\n                    [ngClass]="getClass(DrawableEnum.TextDrawable)">\n                    <fa-icon [icon]="faFont"></fa-icon>\n                </td>\n            </tr>\n            <tr>\n                <td (click)="showColor()" class="toolButton">\n                    <fa-icon [icon]="faSquareFull" [style.color]="color"></fa-icon>\n                    <div *ngIf="showColorPicker" class=\'color-picker-wrapper\'>\n                        <color-photoshop class=\'color-picker\' [color]="color" (onAccept)="onAccept()" (onCancel)="onColorPicked($event)" (onChangeComplete)="onColorChange($event)"></color-photoshop>\n                    </div>\n                </td>\n            </tr>\n            <tr>\n                <td (click)="onUndo.emit()" class="toolButton">\n                    <fa-icon [icon]="faUndo"></fa-icon>\n                </td>\n            </tr>\n            <tr>\n                <td (click)="onClear.emit()" class="toolButton">\n                    <fa-icon [icon]="faBan"></fa-icon>\n                </td>\n            </tr>\n            <tr>\n                <td (click)="onSave.emit()" class="toolButton">\n                    <fa-icon [icon]="faSave"></fa-icon>\n                </td>\n            </tr>\n\n\n        </tbody>\n    </table>\n</div>',styles:[".toolbar{position:fixed;left:0;width:50px;bottom:0;top:0;border:1px solid #888;background:#333;border-radius:5px}.toolButton{overflow:hidden;font-size:18px;width:32px;height:32px;background-color:#333;box-shadow:0 0 2px #66a;padding:1px;margin:0;cursor:pointer;color:#fff}.toolbarTable{width:100%;text-align:center}.active{background-color:rgba(0,0,0,.5)}.color-picker,.color-picker-wrapper{position:absolute}.color-picker{top:0;left:50px}"]}]}],k.ctorParameters=function(){return[]},k.propDecorators={drawableTypeChange:[{type:e.Output}],drawableType:[{type:e.Input}],colorChange:[{type:e.Output}],color:[{type:e.Input}],onUndo:[{type:e.Output}],onClear:[{type:e.Output}],onSave:[{type:e.Output}]};var T=function(){};T.decorators=[{type:e.NgModule,args:[{declarations:[D,k],imports:[n.FontAwesomeModule,r.ColorPhotoshopModule,i.CommonModule],exports:[D]}]}],t.NgAnnoteComponent=D,t.SpproNgAnnoteModule=T,t.ɵa=k,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=sppro-ng-annote.umd.min.js.map